{%extends 'base.html'%}

{%block js%}
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {

        var sse = new EventSource('/haproxy-stats/{{testid}}');
        sse.onmessage = function(message) {
            // console.log('A message has arrived!');
            // console.log(message.data);
            var dados = $.parseJSON(message.data);
            console.log(dados)
            // $('#output').append('<li>'+dados.results+'</li>');
        	$("#results-table > tbody").html("");

            for(var i=0; i<dados.length; i++){
            	dado = dados[i];
            	console.log(dado);
            	$('#results-table > tbody:first')
            		.append('<tr><td>'+dado.svname+'</td><td>'+dado.scur+'</td><td>'+dado.smax+'</td><td>'+dado.stot+'</td><td>'+dado.status+'</td></tr>');
            }
        };

        sse.onerror = function(e) {
		  	console.log("EventSource closed");
		};

});

</script>
{%endblock%}

{%block content%}
	<div class="row">
		<div class="large-12 columns">
			<h2>Execução do teste de escalabilidade</h2>
			<h3>ID: {{testid}}</h3>
			<hr />
		</div>
	</div>

	<div class="row">
		<div class="large-8 columns">
			<div class="row">
				<ul class="test">
					<li>Sua aplicação foi colodada na fila para execução do teste</li>
					<li>Assim que for concluído, será enviado para você um email com o relatório</li>
					<li>Muito obrigado por testar o ambiente da GetupCloud.</li>
					<!-- <li>Finalizado: veja em <a href="/report/{{testid}}.html">Relatório de Resultados</a></li> -->
				</ul>

			<table id="results-table">
				<thead>
					<tr>
						<th>Gear</th>
						<th>Corrente</th>
						<th>Maximo</th>
						<th>Total</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>

			</div>

		</div>

		<div class="large-4 columns">
			<h4>Getup</h4>
			<p>A Getup é uma empresa que presta serviços de hospedagem especializada em aplicações com performance. Veja mais no  <a href="http://getupcloud.com">nosso site</a>.</p>

			<h4>Esta aplicação</h4>
			<p>Esta aplicação o ajudará a fazer um teste de performance e ambiente nos nossos servidores. Este teste é parametrizado e no final você saberá, através de um relatório, tudo o que ocorreu no teste, com comparativos, previsões de gastos, e tudo mais !</p>
			<p>O relatório da sua aplicação ficará disponível para posterior consulta através de um link enviado para seu email.</p>
		</div>

	</div>

{%endblock%}
